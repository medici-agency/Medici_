# КАРТА КОМПОНЕНТІВ MEDICI THEME

## 🗺️ ВІЗУАЛЬНА СХЕМА АРХІТЕКТУРИ

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           MEDICI THEME v1.3.5                                │
│                     WordPress Child Theme for GeneratePress                  │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
          ┌───────────────────────────┼───────────────────────────┐
          │                           │                           │
          ▼                           ▼                           ▼
┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
│   ENTRY POINTS  │      │   PHP MODULES   │      │   FRONTEND      │
│   (WordPress)   │      │   (inc/)        │      │   (CSS/JS)      │
└────────┬────────┘      └────────┬────────┘      └────────┬────────┘
         │                        │                        │
         ▼                        ▼                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                             │
│  ┌──────────────┐   ┌──────────────────────────────────────────────────┐   │
│  │ functions.php│──►│  MODULE LOADER                                   │   │
│  │              │   │  ┌─────────────────────────────────────────────┐ │   │
│  │ • strict_types│   │  │ Priority Load Order:                       │ │   │
│  │ • Module loader│  │  │ 1. theme-setup.php      9. blog-shortcodes │ │   │
│  │ • Events API │   │  │ 2. generatepress.php   10. blog-sidebar     │ │   │
│  └──────────────┘   │  │ 3. assets.php          11. twemoji-local    │ │   │
│                     │  │ 4. performance.php     12. schema-medical   │ │   │
│  ┌──────────────┐   │  │ 5. security.php        13. sitemap-optim    │ │   │
│  │ style.css    │   │  │ 6. class-events.php    14. transliteration  │ │   │
│  │              │   │  │ 7. widgets-init.php                         │ │   │
│  │ Theme meta   │   │  │ 8. blog-cpt.php                            │ │   │
│  │ Version: 1.3.5│  │  └─────────────────────────────────────────────┘ │   │
│  └──────────────┘   └──────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 📦 МОДУЛЬНА СТРУКТУРА

### 1️⃣ CORE MODULES (Базові)

```
┌─────────────────────────────────────────────────────────────────┐
│                        CORE MODULES                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────────┐    ┌──────────────────┐                   │
│  │ theme-setup.php  │    │ generatepress.php │                   │
│  ├──────────────────┤    ├──────────────────┤                   │
│  │ • add_theme_support│   │ • Body classes    │                   │
│  │ • Image sizes    │    │ • GP integration  │                   │
│  │ • Text domain    │    │ • Defaults config │                   │
│  │ • Nav menus      │    │                   │                   │
│  └──────────────────┘    └──────────────────┘                   │
│                                                                  │
│  ┌──────────────────┐    ┌──────────────────┐                   │
│  │ assets.php       │    │ security.php     │                   │
│  ├──────────────────┤    ├──────────────────┤                   │
│  │ • CSS enqueue    │    │ • XML-RPC disable│                   │
│  │ • JS enqueue     │    │ • X-Pingback     │                   │
│  │ • Critical CSS   │    │ • Version hide   │                   │
│  │ • Local fonts    │    │ • RSD link remove│                   │
│  │ • Conditional    │    │                   │                   │
│  └──────────────────┘    └──────────────────┘                   │
│                                                                  │
│  ┌──────────────────┐    ┌──────────────────┐                   │
│  │ performance.php  │    │ class-events.php │                   │
│  ├──────────────────┤    ├──────────────────┤                   │
│  │ • Lazy loading   │    │ • Events API     │                   │
│  │ • Emoji disable  │    │ • Medici\Events  │                   │
│  │ • Fetchpriority  │    │ • AJAX handler   │                   │
│  └──────────────────┘    └──────────────────┘                   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 2️⃣ BLOG MODULE (Блог система)

```
┌─────────────────────────────────────────────────────────────────┐
│                        BLOG MODULE                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                    blog-cpt.php                          │    │
│  │  ┌─────────────────┐  ┌─────────────────┐               │    │
│  │  │ medici_blog CPT │  │ medici_blog_cat │               │    │
│  │  │ • show_in_rest  │  │ • Hierarchical  │               │    │
│  │  │ • Gutenberg OK  │  │ • REST API      │               │    │
│  │  │ • Rewrite rules │  │ • Colors        │               │    │
│  │  └─────────────────┘  └─────────────────┘               │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                │                                 │
│         ┌──────────────────────┼──────────────────────┐         │
│         ▼                      ▼                      ▼         │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐      │
│  │blog-meta-    │    │blog-category-│    │blog-admin-   │      │
│  │fields.php    │    │color.php     │    │settings.php  │      │
│  ├──────────────┤    ├──────────────┤    ├──────────────┤      │
│  │• Reading time│    │• Color picker│    │• Settings API│      │
│  │• Views count │    │• Icons (11)  │    │• Admin page  │      │
│  │• Featured    │    │• Category CSS│    │• Options     │      │
│  │• Meta boxes  │    │              │    │              │      │
│  └──────────────┘    └──────────────┘    └──────────────┘      │
│                                                                  │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐      │
│  │blog-         │    │blog-sidebar- │    │blog-relevant-│      │
│  │shortcodes.php│    │settings.php  │    │services.php  │      │
│  ├──────────────┤    ├──────────────┤    ├──────────────┤      │
│  │[medici_      │    │• Sidebar     │    │• Services    │      │
│  │ warning]     │    │  config      │    │  mapping     │      │
│  │[medici_cta]  │    │• Widget areas│    │• Related     │      │
│  │[medici_      │    │              │    │  content     │      │
│  │ takeaways]   │    │              │    │              │      │
│  └──────────────┘    └──────────────┘    └──────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 3️⃣ SEO & SCHEMA MODULE

```
┌─────────────────────────────────────────────────────────────────┐
│                      SEO & SCHEMA MODULE                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                  schema-medical.php                      │    │
│  │                                                          │    │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │    │
│  │  │Organiza- │ │ FAQPage  │ │  HowTo   │ │ Video-   │   │    │
│  │  │tion      │ │          │ │          │ │ Object   │   │    │
│  │  ├──────────┤ ├──────────┤ ├──────────┤ ├──────────┤   │    │
│  │  │Homepage  │ │Auto-     │ │Auto-     │ │YouTube,  │   │    │
│  │  │only      │ │detect    │ │detect    │ │Vimeo,    │   │    │
│  │  │          │ │from Q&A  │ │from steps│ │self-host │   │    │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘   │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                sitemap-optimization.php                  │    │
│  │                                                          │    │
│  │  Priority: homepage=1.0, blog=0.9, posts=0.7, cats=0.6  │    │
│  │  Exclude: admin, login, cart, checkout, privacy         │    │
│  │  Max: 1000 entries per sitemap                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 4️⃣ UTILITIES MODULE

```
┌─────────────────────────────────────────────────────────────────┐
│                      UTILITIES MODULE                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────────────┐    ┌──────────────────────┐          │
│  │ transliteration.php  │    │ twemoji-local.php    │          │
│  ├──────────────────────┤    ├──────────────────────┤          │
│  │ Cyrillic → Latin     │    │ Local emoji (4009)   │          │
│  │ • sanitize_title     │    │ • SVG format         │          │
│  │ • sanitize_file_name │    │ • CSP compliant      │          │
│  │ • Ukrainian support  │    │ • 18KB library       │          │
│  │ • Russian support    │    │ • Auto-parse         │          │
│  └──────────────────────┘    └──────────────────────┘          │
│                                                                  │
│  ┌────────────────────────────────────────────────────────┐     │
│  │                    widgets/                             │     │
│  │  ┌─────────────────────┐  ┌─────────────────────┐     │     │
│  │  │ widgets-init.php    │  │ class-popular-      │     │     │
│  │  │ • Registration      │  │ posts-widget.php    │     │     │
│  │  │ • Enqueue styles    │  │ • Popular posts     │     │     │
│  │  └─────────────────────┘  └─────────────────────┘     │     │
│  └────────────────────────────────────────────────────────┘     │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🎨 CSS ARCHITECTURE (ITCSS)

```
┌─────────────────────────────────────────────────────────────────┐
│                    CSS ARCHITECTURE (ITCSS)                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ▲ Specificity                                                   │
│  │                                                               │
│  │  ┌─────────────────────────────────────────────────────┐     │
│  │  │ UTILITIES (layout.css)                              │     │
│  │  │ • Grid, hero, footer                                │     │
│  │  └─────────────────────────────────────────────────────┘     │
│  │                                                               │
│  │  ┌─────────────────────────────────────────────────────┐     │
│  │  │ MODULES (modules/blog/)                             │     │
│  │  │ • blog-new.css (948 lines)                         │     │
│  │  │ • blog-single.css (915 lines)                      │     │
│  │  └─────────────────────────────────────────────────────┘     │
│  │                                                               │
│  │  ┌─────────────────────────────────────────────────────┐     │
│  │  │ COMPONENTS (components/)                            │     │
│  │  │ • navigation.css  • forms.css                      │     │
│  │  │ • buttons.css     • faq.css                        │     │
│  │  │ • cards.css       • sections.css                   │     │
│  │  └─────────────────────────────────────────────────────┘     │
│  │                                                               │
│  │  ┌─────────────────────────────────────────────────────┐     │
│  │  │ CORE (core/)                                        │     │
│  │  │ • variables.css (Utopia)                           │     │
│  │  │ • core.css (reset, fonts)                          │     │
│  │  └─────────────────────────────────────────────────────┘     │
│  │                                                               │
│  │  ┌─────────────────────────────────────────────────────┐     │
│  │  │ CRITICAL (inline in <head>)                         │     │
│  │  │ • critical.css                                      │     │
│  │  └─────────────────────────────────────────────────────┘     │
│  │                                                               │
│  └──────────────────────────────────────────────────────────────│
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## ⚡ JAVASCRIPT ARCHITECTURE

```
┌─────────────────────────────────────────────────────────────────┐
│                   JAVASCRIPT ARCHITECTURE                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                    scripts.js (Main)                     │    │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │    │
│  │  │Theme     │ │Mobile    │ │Navigation│ │Smooth    │   │    │
│  │  │Module    │ │Menu      │ │Module    │ │Scroll    │   │    │
│  │  │          │ │Module    │ │          │ │Module    │   │    │
│  │  ├──────────┤ ├──────────┤ ├──────────┤ ├──────────┤   │    │
│  │  │Dark/Light│ │Hamburger │ │Header    │ │Anchor    │   │    │
│  │  │toggle    │ │animation │ │effects   │ │links     │   │    │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘   │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                        FORMS                               │  │
│  │  ┌─────────────────────┐  ┌─────────────────────┐        │  │
│  │  │forms-consultation.js│  │forms-newsletter.js  │        │  │
│  │  │• Email validation   │  │• Email validation   │        │  │
│  │  │• Phone validation   │  │• GTM integration    │        │  │
│  │  │• Textarea autosize  │  │• Form reset         │        │  │
│  │  │• AJAX submission    │  │                     │        │  │
│  │  └─────────────────────┘  └─────────────────────┘        │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                    BLOG MODULES                            │  │
│  │  ┌─────────────────────┐  ┌─────────────────────┐        │  │
│  │  │blog-single.js       │  │blog-new.js          │        │  │
│  │  │• TOC generation     │  │• Filtering          │        │  │
│  │  │• Scroll spy         │  │• Sorting            │        │  │
│  │  │• Progress bar       │  │• AJAX load more     │        │  │
│  │  │• Smooth scroll      │  │• IntersectionObserver│       │  │
│  │  └─────────────────────┘  └─────────────────────┘        │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                      UTILITIES                             │  │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐    │  │
│  │  │events.js     │  │faq-accordion │  │twemoji.min.js│    │  │
│  │  │Events API    │  │• Keyboard nav│  │4009 emoji    │    │  │
│  │  │AJAX client   │  │• ARIA        │  │SVG parsing   │    │  │
│  │  └──────────────┘  └──────────────┘  └──────────────┘    │  │
│  └───────────────────────────────────────────────────────────┘  │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🔗 ЗАЛЕЖНОСТІ МІЖ КОМПОНЕНТАМИ

```
┌─────────────────────────────────────────────────────────────────┐
│                    DEPENDENCY GRAPH                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  functions.php                                                   │
│       │                                                          │
│       ├─► theme-setup.php (немає залежностей)                   │
│       │                                                          │
│       ├─► generatepress.php (немає залежностей)                 │
│       │                                                          │
│       ├─► assets.php                                             │
│       │       ├─► Залежить від: blog-cpt.php (умовне)           │
│       │       └─► Залежить від: performance.php (emoji)         │
│       │                                                          │
│       ├─► performance.php                                        │
│       │       └─► КОНФЛІКТ: дублювання emoji disable            │
│       │                                                          │
│       ├─► security.php (немає залежностей)                      │
│       │                                                          │
│       ├─► class-events.php                                       │
│       │       └─► Використовується: events.js                   │
│       │                                                          │
│       ├─► blog-cpt.php                                          │
│       │       └─► Використовується: blog-meta-fields.php        │
│       │                                                          │
│       ├─► blog-meta-fields.php                                  │
│       │       └─► Залежить від: blog-cpt.php                    │
│       │                                                          │
│       ├─► blog-category-color.php                               │
│       │       └─► Залежить від: blog-cpt.php                    │
│       │                                                          │
│       ├─► schema-medical.php                                    │
│       │       └─► Залежить від: blog-cpt.php (BlogPosting)      │
│       │                                                          │
│       └─► twemoji-local.php                                     │
│               └─► КОНФЛІКТ: дублювання emoji disable            │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🎯 ПОТЕНЦІЙНІ НОВІ МОДУЛІ

```
┌─────────────────────────────────────────────────────────────────┐
│                   POTENTIAL NEW MODULES                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                 BLOG ENHANCEMENT                         │    │
│  │                                                          │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │    │
│  │  │blog-comments │  │blog-related  │  │blog-series   │  │    │
│  │  │.php          │  │.php          │  │.php          │  │    │
│  │  │              │  │              │  │              │  │    │
│  │  │• Moderation  │  │• AI-based    │  │• Post series │  │    │
│  │  │• Anti-spam   │  │• Cache       │  │• Navigation  │  │    │
│  │  │• Email notify│  │• Similar tags│  │• Progress    │  │    │
│  │  └──────────────┘  └──────────────┘  └──────────────┘  │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                 MARKETING & ANALYTICS                    │    │
│  │                                                          │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │    │
│  │  │social-       │  │newsletter-   │  │analytics.php │  │    │
│  │  │sharing.php   │  │integration   │  │              │  │    │
│  │  │              │  │.php          │  │              │  │    │
│  │  │• Share btns  │  │• Mailchimp   │  │• Custom evts │  │    │
│  │  │• Open Graph  │  │• SendPulse   │  │• Conversions │  │    │
│  │  │• Twitter Card│  │• Double opt-in│ │• Core Vitals │  │    │
│  │  └──────────────┘  └──────────────┘  └──────────────┘  │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                 PERFORMANCE & CACHE                      │    │
│  │                                                          │    │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │    │
│  │  │critical-css  │  │image-        │  │service-      │  │    │
│  │  │generator.php │  │optimizer.php │  │worker.php    │  │    │
│  │  │              │  │              │  │              │  │    │
│  │  │• Auto-extract│  │• WebP convert│  │• Offline mode│  │    │
│  │  │• Per-page    │  │• Lazy load   │  │• Cache API   │  │    │
│  │  │• Minify      │  │• AVIF support│  │• Push notify │  │    │
│  │  └──────────────┘  └──────────────┘  └──────────────┘  │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📊 МЕТРИКИ КОМПОНЕНТІВ

| Компонент            | Рядків | Залежності | Якість | Пріоритет рефакторингу |
| -------------------- | ------ | ---------- | ------ | ---------------------- |
| assets.php           | 528    | 2          | 8.5/10 | Low                    |
| blog-cpt.php         | 429    | 0          | 8.0/10 | Low                    |
| blog-meta-fields.php | 436    | 1          | 6.5/10 | **High**               |
| blog-shortcodes.php  | 191    | 1          | 8.0/10 | Low                    |
| schema-medical.php   | 665    | 1          | 8.5/10 | Low                    |
| transliteration.php  | 220    | 0          | 7.5/10 | Medium                 |
| scripts.js           | 646    | 0          | 7.5/10 | **High**               |
| blog-new.js          | 593    | 0          | 7.0/10 | **High**               |
| blog-single.js       | 312    | 0          | 7.5/10 | Medium                 |
| blog-new.css         | 948    | 0          | 5.5/10 | **Critical**           |
| blog-single.css      | 915    | 0          | 6.0/10 | **Critical**           |
| forms.css            | 500    | 0          | 5.0/10 | **Critical**           |

---

_Карта створена: 2025-12-12_
_Версія: 1.0_
